<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ë‹¨ì§€ ì•„íŒŒíŠ¸ ì¡°ê°ë„ ì•ˆë‚´ ë§µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 400px;
            height: 100vh;
            gap: 0;
        }

        /* ì¢Œì¸¡ - ë§µ ì˜ì—­ */
        .map-section {
            position: relative;
            background-color: #000;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .map-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .map-image {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        .map-image.hidden {
            display: none;
        }

        .svg-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .svg-overlay svg {
            width: 100%;
            height: 100%;
        }

        .svg-overlay polygon {
            pointer-events: all;
            fill: transparent;
            stroke: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .svg-overlay polygon:hover {
            fill: rgba(0, 255, 0, 0.4);
            stroke: rgba(0, 255, 0, 0.8);
            stroke-width: 2;
        }

        .svg-overlay polygon.active {
            fill: rgba(0, 123, 255, 0.5);
            stroke: rgba(0, 123, 255, 1);
            stroke-width: 3;
        }

        /* ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ placeholder */
        .map-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 50%, #a5d6a7 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
        }

        .map-placeholder svg {
            width: 100%;
            height: 100%;
            opacity: 0.3;
        }

        /* ìš°ì¸¡ - ì •ë³´ íŒ¨ë„ */
        .info-panel {
            background-color: #ffffff;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .info-panel h2 {
            color: #333;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            border-bottom: 2px solid #007bff;
            padding-bottom: 0.5rem;
        }

        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeIn 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-card h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .info-card .households {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            opacity: 0.95;
        }

        .info-card .description {
            font-size: 1rem;
            line-height: 1.6;
            opacity: 0.9;
        }

        .info-placeholder {
            text-align: center;
            color: #999;
            padding: 3rem 1rem;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .info-placeholder::before {
            content: "ğŸ“";
            display: block;
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: 60vh 40vh;
            }

            .map-section {
                height: 100%;
            }

            .info-panel {
                padding: 1.5rem;
            }

            .info-panel h2 {
                font-size: 1.3rem;
            }

            .info-card h3 {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                grid-template-rows: 50vh 50vh;
            }

            .info-panel {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <main class="container">
        <!-- ì¢Œì¸¡ - ë§µ ì˜ì—­ -->
        <section class="map-section">
            <div class="map-wrapper">
                <img src="placeholders/map_2d.png" alt="ëŒ€ë‹¨ì§€ ì•„íŒŒíŠ¸ ì¡°ê°ë„" class="map-image" id="mapImage">
                <div class="map-placeholder" id="mapPlaceholder" style="display: none;">
                    <svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
                        <rect width="1200" height="800" fill="#e8f5e9"/>
                        <text x="600" y="400" font-family="Arial, sans-serif" font-size="24" fill="#757575" text-anchor="middle" opacity="0.7">
                            ì¡°ê°ë„ ì´ë¯¸ì§€ë¥¼ placeholders/map-image.jpgì— ì¶”ê°€í•˜ì„¸ìš”
                        </text>
                    </svg>
                </div>
                <div class="svg-overlay" id="svgOverlay">
                    <svg id="mapSvg" viewBox="0 0 100 100" preserveAspectRatio="none">
                        <!-- Polygon ìš”ì†Œë“¤ì´ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
                    </svg>
                </div>
            </div>
        </section>

        <!-- ìš°ì¸¡ - ì •ë³´ íŒ¨ë„ -->
        <aside class="info-panel">
            <h2>ë¸”ëŸ­ ì •ë³´</h2>
            <div id="infoContent">
                <div class="info-placeholder">
                    êµ¬ì—­ì„ ì„ íƒí•˜ì„¸ìš”
                </div>
            </div>
        </aside>
    </main>

    <script>
        // ë¸”ëŸ­ ë°ì´í„° êµ¬ì¡°
        // ì œê³µëœ SVG ì½”ë“œì—ì„œ ë³€í™˜ëœ ì¢Œí‘œ (viewBox: 2496x1696)
        // data-index 7, 9ëŠ” ìœ íš¨í•˜ì§€ ì•Šì•„ ì œì™¸ë¨
        const blocks = [
            { 
                id: 1, 
                name: "1 Block", 
                households: 1020,
                description: "ì¾Œì í•œ ê³µì› ë·°ì™€ ì¡°ìš©í•œ ì£¼ê±° í™˜ê²½",
                points: "45.11% 57.16%, 69.04% 60.52%, 69.80% 85.81%, 32.95% 78.55%, 27.92% 71.42%"
            },
            { 
                id: 2, 
                name: "2 Block", 
                households: 980,
                description: "ì§€í•˜ì² ì—­ ì¸ì ‘, êµí†µ í¸ë¦¬",
                points: "25.07% 40.53%, 43.59% 55.35%, 25.93% 70.02%, 9.12% 48.78%"
            },
            { 
                id: 3, 
                name: "3 Block", 
                households: 1050,
                description: "ì¤‘ì•™ ê³µì› ì¡°ë§, í”„ë¦¬ë¯¸ì—„ ìœ„ì¹˜",
                points: "8.07% 48.08%, 0.85% 37.46%, 5.22% 29.63%, 12.82% 24.32%, 22.60% 26.97%, 18.14% 33.40%, 24.31% 39.69%"
            },
            { 
                id: 4, 
                name: "4 Block", 
                households: 995,
                description: "ìƒì—…ì‹œì„¤ ì¸ì ‘, ìƒí™œ í¸ì˜ì„± ìš°ìˆ˜",
                points: "14.53% 23.06%, 22.51% 17.47%, 29.63% 19.43%, 32.38% 22.78%, 23.55% 26.28%"
            },
            { 
                id: 5, 
                name: "5 Block", 
                households: 1035,
                description: "í•™êµ ì¸ì ‘, êµìœ¡ í™˜ê²½ ìµœì í™”",
                points: "45.96% 23.06%, 50.81% 18.59%, 66.95% 22.22%, 63.72% 26.97%"
            },
            { 
                id: 6, 
                name: "6 Block", 
                households: 1010,
                description: "ë„“ì€ ì¡°ê²½ ê³µê°„, ì¾Œì í•œ í™˜ê²½",
                points: "31.91% 19.85%, 33.52% 22.64%, 38.18% 21.66%, 44.73% 22.36%, 49.67% 18.17%, 38.18% 15.93%"
            },
            { 
                id: 7, 
                name: "7 Block", 
                households: 990,
                description: "ì£¼ì°¨ ì‹œì„¤ ì™„ë¹„, ì£¼ê±° í¸ì˜ì„±",
                points: "68.66% 27.11%, 69.99% 22.08%, 80.72% 24.60%, 84.52% 26.28%, 74.26% 29.35%"
            },
            { 
                id: 8, 
                name: "8 Block", 
                households: 1045,
                description: "ì¤‘ì•™ ìœ„ì¹˜, ëª¨ë“  ì‹œì„¤ ì ‘ê·¼ ìš©ì´",
                points: "74.36% 30.75%, 85.95% 27.39%, 93.54% 41.51%, 75.88% 39.97%"
            },
            { 
                id: 9, 
                name: "9 Block", 
                households: 1005,
                description: "ì¡°ìš©í•œ ì£¼ê±° í™˜ê²½, í”„ë¼ì´ë²„ì‹œ ë³´ì¥",
                points: "76.26% 42.35%, 95.06% 44.16%, 99.62% 54.79%, 77.97% 52.55%"
            },
            { 
                id: 10, 
                name: "10 Block", 
                households: 1025,
                description: "ê³µì›ê³¼ ì¸ì ‘, ìì—° ì¹œí™”ì ",
                points: "78.25% 54.23%, 99.53% 56.60%, 99.62% 70.72%, 80.44% 60.10%"
            },
            { 
                id: 11, 
                name: "11 Block", 
                households: 975,
                description: "ìƒê°€ ì¸ì ‘, ì¼ìƒ ìƒí™œ í¸ë¦¬",
                points: "88.98% 69.88%, 98.96% 76.17%, 98.86% 90.57%, 88.89% 89.03%, 85.00% 75.61%"
            },
            { 
                id: 12, 
                name: "12 Block", 
                households: 1020,
                description: "ìµœì‹  ì‹œì„¤, í”„ë¦¬ë¯¸ì—„ ë¼ì´í”„ìŠ¤íƒ€ì¼",
                points: "59.35% 37.74%, 52.90% 48.08%, 67.52% 53.53%, 69.80% 47.66%, 68.47% 40.39%"
            }
        ];

        // DOM ìš”ì†Œ ì°¸ì¡°
        const mapImage = document.getElementById('mapImage');
        const mapPlaceholder = document.getElementById('mapPlaceholder');
        const mapSvg = document.getElementById('mapSvg');
        const svgOverlay = document.getElementById('svgOverlay');
        const infoContent = document.getElementById('infoContent');

        // SVG viewBox ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateSvgViewBox() {
            if (!mapImage.complete || mapImage.naturalWidth === 0) return;
            
            const rect = mapImage.getBoundingClientRect();
            const naturalWidth = mapImage.naturalWidth;
            const naturalHeight = mapImage.naturalHeight;
            
            // SVG viewBoxë¥¼ ì´ë¯¸ì§€ì˜ ì‹¤ì œ í¬ê¸°ì— ë§ì¶¤
            mapSvg.setAttribute('viewBox', `0 0 ${naturalWidth} ${naturalHeight}`);
            mapSvg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
        }

        // í¼ì„¼íŠ¸ ì¢Œí‘œë¥¼ í”½ì…€ ì¢Œí‘œë¡œ ë³€í™˜
        function percentToPixel(pointsString, imgWidth, imgHeight) {
            // "20% 10%, 40% 15%, ..." í˜•ì‹ì„ íŒŒì‹±
            const points = pointsString.split(',').map(p => {
                const [x, y] = p.trim().split(' ').map(v => parseFloat(v));
                return {
                    x: (x / 100) * imgWidth,
                    y: (y / 100) * imgHeight
                };
            });
            
            return points.map(p => `${p.x},${p.y}`).join(' ');
        }

        // Polygon ìƒì„± í•¨ìˆ˜
        function createPolygons() {
            if (!mapImage.complete || mapImage.naturalWidth === 0) {
                // ì´ë¯¸ì§€ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ëŒ€ê¸°
                setTimeout(createPolygons, 100);
                return;
            }

            const imgWidth = mapImage.naturalWidth;
            const imgHeight = mapImage.naturalHeight;

            // ê¸°ì¡´ polygon ì œê±°
            mapSvg.innerHTML = '';

            blocks.forEach(block => {
                if (!block.points) return;

                const pixelPoints = percentToPixel(block.points, imgWidth, imgHeight);
                
                const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                polygon.setAttribute('points', pixelPoints);
                polygon.setAttribute('data-block-id', block.id);
                polygon.setAttribute('class', 'block-polygon');
                
                mapSvg.appendChild(polygon);
            });

            updateSvgViewBox();
        }

        // ì •ë³´ ì¹´ë“œ ë Œë”ë§ í•¨ìˆ˜
        function renderInfoCard(block) {
            return `
                <div class="info-card">
                    <h3>${block.name}</h3>
                    <div class="households">ì„¸ëŒ€ìˆ˜: ${block.households.toLocaleString()}ì„¸ëŒ€</div>
                    <div class="description">${block.description}</div>
                </div>
            `;
        }

        // ì •ë³´ íŒ¨ë„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateInfoPanel(blockId) {
            const block = blocks.find(b => b.id === blockId);
            if (block) {
                infoContent.innerHTML = renderInfoCard(block);
                // LocalStorageì— ì €ì¥
                localStorage.setItem('lastSelectedBlock', blockId.toString());
            } else {
                infoContent.innerHTML = '<div class="info-placeholder">êµ¬ì—­ì„ ì„ íƒí•˜ì„¸ìš”</div>';
            }
        }

        // í™œì„± polygon í‘œì‹œ í•¨ìˆ˜
        function setActivePolygon(blockId) {
            // ëª¨ë“  polygonì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.block-polygon').forEach(poly => {
                poly.classList.remove('active');
            });
            // ì„ íƒëœ polygonì— active í´ë˜ìŠ¤ ì¶”ê°€
            const selectedPoly = document.querySelector(`.block-polygon[data-block-id="${blockId}"]`);
            if (selectedPoly) {
                selectedPoly.classList.add('active');
            }
        }

        // ì´ë²¤íŠ¸ ìœ„ì„ì„ ì‚¬ìš©í•œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        mapSvg.addEventListener('mouseenter', (e) => {
            if (e.target.classList.contains('block-polygon')) {
                const blockId = parseInt(e.target.getAttribute('data-block-id'));
                updateInfoPanel(blockId);
            }
        }, true);

        mapSvg.addEventListener('mouseleave', (e) => {
            if (e.target.classList.contains('block-polygon')) {
                // ë§ˆìš°ìŠ¤ê°€ polygonì„ ë²—ì–´ë‚  ë•ŒëŠ” LocalStorageì— ì €ì¥ëœ ì •ë³´ë¥¼ ìœ ì§€
                const lastSelected = localStorage.getItem('lastSelectedBlock');
                if (lastSelected) {
                    updateInfoPanel(parseInt(lastSelected));
                    setActivePolygon(parseInt(lastSelected));
                } else {
                    infoContent.innerHTML = '<div class="info-placeholder">êµ¬ì—­ì„ ì„ íƒí•˜ì„¸ìš”</div>';
                }
            }
        }, true);

        mapSvg.addEventListener('click', (e) => {
            if (e.target.classList.contains('block-polygon')) {
                const blockId = parseInt(e.target.getAttribute('data-block-id'));
                setActivePolygon(blockId);
                updateInfoPanel(blockId);
            }
        });

        // ì´ë¯¸ì§€ ë¡œë“œ ì²´í¬
        function checkImageLoad() {
            if (mapImage.complete && mapImage.naturalHeight !== 0) {
                // ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë¨
                mapPlaceholder.style.display = 'none';
                createPolygons();
            } else {
                // ì´ë¯¸ì§€ê°€ ì—†ê±°ë‚˜ ë¡œë“œ ì‹¤íŒ¨
                mapImage.classList.add('hidden');
                mapPlaceholder.style.display = 'flex';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        function init() {
            // ì´ë¯¸ì§€ ë¡œë“œ ìƒíƒœ í™•ì¸
            if (mapImage.complete) {
                checkImageLoad();
            } else {
                mapImage.addEventListener('load', () => {
                    checkImageLoad();
                    // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ viewBox ì—…ë°ì´íŠ¸
                    window.addEventListener('resize', () => {
                        updateSvgViewBox();
                        createPolygons();
                    });
                });
                mapImage.addEventListener('error', () => {
                    mapImage.classList.add('hidden');
                    mapPlaceholder.style.display = 'flex';
                });
            }
            
            // LocalStorageì—ì„œ ë§ˆì§€ë§‰ ì„ íƒëœ ë¸”ëŸ­ ë¶ˆëŸ¬ì˜¤ê¸°
            const lastSelected = localStorage.getItem('lastSelectedBlock');
            if (lastSelected) {
                const blockId = parseInt(lastSelected);
                updateInfoPanel(blockId);
                // ì´ë¯¸ì§€ê°€ ë¡œë“œëœ í›„ì— active í‘œì‹œ
                setTimeout(() => {
                    setActivePolygon(blockId);
                }, 500);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì´ˆê¸°í™” ì‹¤í–‰
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>

